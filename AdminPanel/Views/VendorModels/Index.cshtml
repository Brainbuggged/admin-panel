@model IEnumerable<AdminPanel.Models.Models.NSI_Vendor.VendorModel>

@{
    ViewData["Title"] = "Index";
}

<h1>Продавцы</h1>

<table id="vendors" class="display" style="width:100%">
    <thead>
        <tr>
            <th>
                <p>Фото</p>
                @*@Html.DisplayNameFor(model => model.photo)*@
            </th>
            <th>
                <p>Фамилия</p>
                @*@Html.DisplayNameFor(model => model.surname)*@
            </th>
            <th>
                <p>Имя</p>
                @*@Html.DisplayNameFor(model => model.name)*@
            </th>
            <th>
                <p>Отчество</p>
                @*@Html.DisplayNameFor(model => model.patronymic)*@
            </th>
            <th>
                <p>Телефон</p>
                @*@Html.DisplayNameFor(model => model.phone)*@
            </th>
            <th>
                <p>Почта</p>
                @*@Html.DisplayNameFor(model => model.email)*@
            </th>
            <th>
                <p>Рейтинг</p>
                @*@Html.DisplayNameFor(model => model.photo)*@
            </th>
            <th>
                @Html.DisplayNameFor(model => model.comment_count)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.orders.First().position_count)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.orders.First().total_prise)
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>
                @{
                    var photoimage = item.photo;
                }
                <img src="https://drive.google.com/uc?export=view&id=@photoimage" width="100px" height="100px" />
            </td>
            <td>
                @{
                    var reference = "http://budevice.ru/vendor/" + @Html.DisplayFor(modelItem => item.number);
                }
                <a href="@reference">@Html.DisplayFor(modelItem => item.surname)</a>
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.patronymic)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.phone)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.email)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.rating)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.comment_count)
            </td>
            <td>
                @{ 
                    var count = item.orders.Where(o => o.vendorid == item.id).Sum(x => x.position_count);
                  }
                @*@Html.DisplayFor(modelItem => item.orders.Where(o => o.vendorid == item.id).Sum( x=> x.position_count))*@
                <p>@count</p>
            </td>
            <td>
                @{
                    var totalPrice = item.orders.Where(o => o.vendorid == item.id).Sum(x => x.total_prise);
                }
                    @*@Html.DisplayFor(modelItem => item.orders.Where(o => o.vendorid == item.id).Sum( x => x.total_prise))*@
                <p> @Math.Round(totalPrice,2) руб</p>
            </td>
        </tr>
        }
    </tbody>
</table>

<script>
    $(document).ready(function () {
        $('#vendors').DataTable({
            "language": jsonLanguageDataTable
        });
    });
</script>
